## Анализатор логов nginx

### Краткое описание
Анализатор находит в папке с логами последний необработанный файл (по дате в названии), вытаскивает из каждой строки URL и $request_time и генерирует отчёт по каждому URL'у со следующими характеристиками:
* count - сколько раз встречается URL'а в логе, абсолютное значение,
* count_perc - сколько раз встречается URL'а в логе, в процентах от общего числа запросов,
* time_sum - суммарный $request_time для данного URL'а, абсолютное значение,
* time_perc - суммарный $request_time для данного URL'а, в процентах от суммарного $request_time всех запросов,
* time_avg - средний $request_time для данного URL'а,
* time_max - максимальный $request_time для данного URL'а,
* time_med - медиана $request_time для данного URL'а,

### Требования
* Установленный Python 3.4+

### Настройка
Анализатору можно передать файл .properties со следующими настройками:
* REPORT_SIZE - количество строк в отчёте (по-умолчанию 1000),
* REPORT_DIR - каталог с отчётами (по-умолчанию ./reports),
* LOG_DIR - каталог, где лежат логи nginx'a (по-умолчанию ./log),
* SELF_LOG_DIR - каталог, куда будет писать свой лог анализатор (по-умолчанию ./log),
* REPORT_TEMPLATE_DIR - каталог, где лежит шаблон отчёта (по-умолчанию ./resources),
* LOG_REGEXP - регулярное выражение для разбора лога (переопределять только при острой необходимости, в регулярном выражении обязательно должны быть алиасы url и $request_time)
* ALLOWED_ERRORS_PERCENT - допустимый процент ошибок при разборе строк лога (по-умолчанию 15),
* ALLOWED_EXTENSIONS - допустимые расширения для файлов с логами (по-умолчанию ['', '.gz']),
* LOG_ENCODING - кодировка файлов с логами (по-умолчанию 'cp1251')

### Запуск тестов
```
python3 -m unittest test/test_log_analyzer.py
```

### Запуск анализатора
```
cd src/ru/otus/python
python3 log_analyzer.py [--config <config_path>]
```